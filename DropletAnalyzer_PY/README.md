# DropletAnalyzer Python Tools

## MakeCSV.py

This script processes droplet measurement data from the DropletAnalyzer C++ program and creates a tidy CSV output format.

### Usage

```bash
python MakeCSV.py <template_csv> <data_directory> [-o output.csv]
```

### Arguments

1. `template_csv` (required): Path to the experiment template CSV file that maps experiment codes to parameters
   - Example: `Experiment_Template_Example.csv`
   - Format: Must contain columns: `Code`, `Foil`, `Femulsion`, `Finject`, `Voltage`, `Measured?`

2. `data_directory` (required): Path to the directory containing experiment subfolders
   - Each subfolder should be named with the experiment code (e.g., `PICOINJ_3_1`)
   - Each subfolder should contain an `Outputs` subdirectory with QC images

3. `-o, --output` (optional): Path to the output CSV file
   - Default: `<data_directory>/output.csv`

### Example

```bash
python MakeCSV.py Experiment_Template_Example.csv C:\Data\Experiments -o results.csv
```

### Expected Directory Structure

```
Data_Directory/
├── PICOINJ_3_1/
│   ├── <raw images>
│   └── Outputs/
│       ├── 1_VALID_40p50_103p25.jpg
│       ├── 2_VALID_25p00_160p50.jpg
│       ├── 3_INVALID_0p00_0p00.jpg
│       └── ...
├── PICOINJ_3_2/
│   ├── <raw images>
│   └── Outputs/
│       └── ...
└── ...
```

### Output Format

The script produces a CSV file with the following columns:
- `Code`: Experiment code (from folder name)
- `Foil`: Parameter from template CSV
- `Femulsion`: Parameter from template CSV
- `Finject`: Parameter from template CSV
- `Voltage`: Parameter from template CSV
- `Measured?`: Parameter from template CSV
- `Index`: Droplet index number
- `Valid?`: VALID or INVALID
- `Diameter (um)`: Droplet diameter in micrometers (or "NA" for invalid droplets)
- `GrayVal (A.U.)`: Mean gray value in arbitrary units (or "NA" for invalid droplets)

### Image Naming Convention

The script parses QC images generated by the DropletAnalyzer C++ program with the following naming convention:

- **Valid droplets**: `<index>_VALID_<diameter>_<grayval>.jpg`
  - Example: `1_VALID_40p50_103p25.jpg` (diameter = 40.5 µm, gray value = 103.25)
  
- **Invalid droplets**: `<index>_INVALID_0p00_0p00.jpg`
  - Example: `3_INVALID_0p00_0p00.jpg`

Note: Decimal points in filenames are represented as "p" (e.g., "12p45" = 12.45)

### Error Handling

- The script will warn if an experiment code found in the directory is not present in the template CSV
- Images that don't match the expected naming pattern will be skipped with a warning
- The script will report the number of measurements found for each experiment

